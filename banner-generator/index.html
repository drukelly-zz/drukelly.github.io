<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Banner Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.9.0/css/tachyons.min.css"/>
  <link rel="stylesheet" href="/dist/css/app.css"/>
  <script src="https://unpkg.com/vue@2.5.11/dist/vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>
<body class="sans-serif ma4">
  
  <div id="app" class="w-100">

    <h1 class="black-60 f5 ttu tracked">Banner Generator (Beta)</h1>
    
    <div class="flex items-center">

      <div class="w-30">
        <div class="bg-light-gray black-80 pv2">
          <ol>
            <li class="mb2">Choose a banner design</li>
            <li class="mb2">Update the text</li>
            <li>Download</li>
          </ol>
        </div>

        <form method="get" id="textGenerator" class="pt4">
          <label class="dib mb2 w-100">
            <div class="black-50 dib f7 mr1 tracked ttu">Design</div>
            <ul id="designOptions" class="list pl0">
              <li v-for="item in options" class="tc dib mr2">
                <img @click="pickOption" :src="'/images/btn-' + item.value + '.png'" :data-option="item.value" alt="" class="option b--black-40 ba br2 h3 w3 dib">
              </li>
            </ul>
          </label>
          <label for="headline" class="dib mb4 w-100">
            <div class="black-50 f7 mb1 tracked ttu">Headline</div>
            <input type="text" name="headline" v-model="headline" class="ba b--black-40 pa1 w-100">
          </label>
          <label for="location" class="dib mb4 w-100">
            <div class="black-50 f7 mb1 tracked ttu">Location</div>
            <textarea name="location" v-model="location" cols="30" rows="5" class="ba b--black-40 pa1 w-100"></textarea>
          </label>
          <label for="date" class="dib mb4 w-100">
            <div class="black-50 f7 mb1 tracked ttu">Date</div>
            <input type="text" name="date" v-model="dateDisplay" class="ba b--black-40 pa1 w-100">
          </label>
          <label for="time" class="dib mb4 w-100">
            <div class="black-50 f7 mb1 tracked ttu">Time</div>
            <input type="text" name="time" v-model="timeDisplay" class="ba b--black-40 pa1 w-100">
          </label>
          <label for="finePrint" class="dib mb4 w-100">
            <div class="black-50 f7 mb1 tracked ttu">Fine Print</div>
            <input type="text" name="finePrint" v-model="finePrint" class="ba b--black-40 pa1 w-100">
          </label>
        </form>
      </div>

      <div class="w-10"></div>
      
      <div class="w-60">
        <div class="target ba b--black-40 flex items-center mv4"
          v-for="type in types"
          :id="type.value + '-preview'"
          :data="options.option">
          <div class="positioning-container">
            <header class="ma0 relative ttu">{{ headline }}</header>  
            <p class="location ma0 relative">{{ location }}</p>
            <p class="date-time ma0 relative"><strong class="db">{{ dateDisplay }}</strong> {{ timeDisplay }}</p>
            <p class="finePrint ma0 relative"><small>{{ finePrint }}</small></p>
          </div>
          <div class="background"></div>
        </div>
        <p class="black-50 f7 ttu tracked">Source <a href="#" id="source-download" class="bg-green br-pill dib dim link ml2 mr4 ph3 pv2 white">Download</a>
        Vault <a href="#" id="vault-download" class="bg-green br-pill dib dim link ml2 ph3 pv2 white">Download</a> </p>  
      </div>
    </div>
  </div>

  <script>
    var app = new Vue({
      el: '#app',
      data: {
        headline: 'Please Join Us Live For The Q4 FY18 Company Meeting',
        location: 'in the Palo Alto Prom F Gym or via webcast',
        dateDisplay: 'Thursday, December 7, 2017',
        timeDisplay: 'from 9:00 AM - 10:30 AM PST',
        finePrint: 'Visit the Company Meeting Source page for details',
        options: [
          { value: 'option1' },
          { value: 'option2' },
          { value: 'option3' }
        ],
        types: [
          { value: 'source' },
          { value: 'vault' }
        ]
      },
      methods: {
        pickOption: function(e) {
          // select the divs to update with selected option class name
          const targetDivs = document.querySelectorAll('.target');
          const selectedOption = e.target.dataset.option;

          // update target divs based on selected option
          targetDivs.forEach(function(element) {
            if ([].some.call(element.classList, c => /option.*/.test(c))) {
              element.classList.remove('option1', 'option2', 'option3');
            }
            element.classList.add(selectedOption);
          });
        }
      }
    });

    // download links
    const sourceDownload = document.querySelector('#source-download');
    const vaultDownload = document.querySelector('#vault-download');
    // generate canvas from source div
    const sourceDiv = document.querySelector('#source-preview');
    const vaultDiv = document.querySelector('#vault-preview');

    window.addEventListener('mousemove', function(e){
      // generate download link for source
      html2canvas(sourceDiv, {
        onrendered: function(canvas) {
          const image = canvas.toDataURL('image/png').replace('image/png','application/octet-stream');
          sourceDownload.setAttribute('href', image);
          sourceDownload.setAttribute('download', 'source-banner.png');
        }
      });
      // generate download link for vault
      html2canvas(vaultDiv, {
        onrendered: function(canvas) {
          const image = canvas.toDataURL('image/png').replace('image/png','application/octet-stream');
          vaultDownload.setAttribute('href', image);
          vaultDownload.setAttribute('download', 'vault-banner.png')
        }
      });
    });
  </script>

</body>
</html>